<!DOCTYPE html>
<html lang="sv" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowVault - Sveriges ledande automationsbibliotek | NordSym</title>
    <meta name="description" content="100+ verifierade automationer f칬r n8n och AI. Gratis nedladdning. Byggt i Stockholm av NordSym AB.">
    <link rel="icon" type="image/svg+xml" href="https://raw.githubusercontent.com/GusHem/NordSym-Logga/refs/heads/main/Final%20logo%20no%20text.svg">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

    <!-- Configuration -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        heading: ['Comfortaa', 'cursive'],
                        body: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: { DEFAULT: '#00BFFF', hover: '#00D4FF', light: 'rgba(0, 191, 255, 0.1)' },
                        slate: { 850: '#151F32', 950: '#020617' },
                        n8n: '#FF6D5A', make: '#6F3BF5', zapier: '#FF4F00', fortnox: '#ED3237',
                        pro: { DEFAULT: '#f59e0b', light: '#fef3c7', dark: '#78350f' }, // Amber
                        ent: { DEFAULT: '#8b5cf6', light: '#ede9fe', dark: '#4c1d95' }  // Violet
                    },
                    animation: {
                        'bounce-slow': 'bounce 3s infinite',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background-color: #334155; }
        ::-webkit-scrollbar-thumb:hover { background-color: #94a3b8; }
        
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 200ms ease-out, transform 200ms ease-out; }
        
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); }
        .dark .glass { background: rgba(15, 23, 42, 0.85); }
        
        .platform-n8n { color: #FF6D5A; background-color: rgba(255, 109, 90, 0.1); }
        .platform-make { color: #6F3BF5; background-color: rgba(111, 59, 245, 0.1); }
        
        .badge-pro { background: linear-gradient(to right, #f59e0b, #d97706); color: white; border: 1px solid #b45309; box-shadow: 0 1px 2px rgba(245, 158, 11, 0.3); }
        
        body { position: relative; z-index: 1; }

        .stars-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; opacity: 0; transition: opacity 0.8s ease; }
        .dark .stars-wrapper { opacity: 1; }
        
        .grid-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0;
            background-size: 24px 24px;
            background-image: 
                linear-gradient(to right, rgba(0, 0, 0, 0.05) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(0, 0, 0, 0.05) 1px, transparent 1px);
            opacity: 1; transition: opacity 0.5s ease;
        }
        .dark .grid-bg { opacity: 0; }

        .typing-dot { width: 6px; height: 6px; background-color: currentColor; border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; } .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .message-enter { animation: slideInUp 0.3s ease-out forwards; }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 font-body transition-colors duration-300 antialiased min-h-screen flex flex-col">

    <div class="stars-wrapper"><canvas id="starfall"></canvas></div>
    <div class="grid-bg"></div>

    <!-- Header -->
    <header class="sticky top-0 z-40 w-full border-b border-slate-200 dark:border-slate-800 glass">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3 cursor-pointer" onclick="resetApp()">
                <img src="https://raw.githubusercontent.com/GusHem/NordSym-Logga/refs/heads/main/Final%20logo%20no%20text.svg" alt="NordSym Logo" class="w-10 h-10 object-contain">
                <div class="flex flex-col justify-center">
                    <div class="flex items-center gap-2">
                        <h1 class="font-heading text-xl font-bold tracking-tight leading-none text-slate-900 dark:text-white">FlowVault</h1>
                        <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-primary/10 text-primary border border-primary/20">BETA</span>
                    </div>
                    <span class="text-[10px] text-slate-500 font-medium tracking-wide uppercase">Powered by NordSym</span>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <div id="download-counter" class="hidden md:flex flex-col items-end mr-2">
                    <div class="text-[10px] text-slate-500 uppercase tracking-wider font-bold">Gratis Nedladdningar</div>
                    <div class="flex items-center gap-1 text-sm font-medium">
                        <span id="dl-count" class="text-primary font-bold">0</span><span class="text-slate-400">/</span><span class="text-slate-600 dark:text-slate-300">3</span>
                    </div>
                </div>
                <button onclick="openPaywall('upgrade_header')" class="hidden sm:flex btn-sm bg-pro hover:bg-amber-600 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-md shadow-amber-500/20 transition-all hover:scale-105">Uppgradera</button>
                <button onclick="handleAuthClick()" id="auth-btn" class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors relative group" aria-label="Mitt konto">
                    <i data-lucide="user-circle" class="w-6 h-6 text-slate-600 dark:text-slate-300 group-hover:text-primary transition-colors"></i>
                    <span id="auth-status-dot" class="absolute top-1.5 right-1.5 w-2 h-2 rounded-full bg-slate-300 border-2 border-white dark:border-slate-950"></span>
                </button>
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors" aria-label="츿ndra tema">
                    <i data-lucide="sun" class="w-5 h-5 hidden dark:block text-amber-400"></i>
                    <i data-lucide="moon" class="w-5 h-5 block dark:hidden text-slate-600"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full py-8 sm:py-12 relative z-10">
        
        <div class="text-center max-w-2xl mx-auto mb-10">
            <h2 class="font-heading text-3xl sm:text-4xl font-bold mb-4">
                Automatisera snabbare. <br class="hidden sm:block" /> Sluta bygga om hjulet.
            </h2>
            <p class="text-slate-500 dark:text-slate-400 mb-8 text-lg">
                Sveriges st칬rsta samling av verifierade n8n & Make workflows.
            </p>

            <div class="relative max-w-xl mx-auto group mb-4">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <i data-lucide="search" class="w-5 h-5 text-slate-400 group-focus-within:text-primary transition-colors"></i>
                </div>
                <input type="text" id="search-input" placeholder="S칬k automationer (t.ex. 'ai agent', 'email')..." class="block w-full pl-11 pr-4 py-4 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all shadow-sm text-lg placeholder:text-slate-400" oninput="handleSearch(this.value)">
            </div>
            
            <div class="text-sm text-slate-500 dark:text-slate-400">
                Hittar du inte det du s칬ker? 
                <button onclick="openRequestModal()" class="text-primary hover:text-primary-hover font-semibold hover:underline transition-all ml-1 inline-flex items-center gap-1 group">
                    칐nska en automation <i data-lucide="arrow-right" class="w-3 h-3 group-hover:translate-x-0.5 transition-transform"></i>
                </button>
            </div>
        </div>

        <div class="mb-8 space-y-6">
            <div class="flex flex-wrap justify-center gap-2" id="category-filters"></div>
            <div class="flex flex-col md:flex-row gap-4 items-center justify-between bg-slate-50 dark:bg-slate-900/50 p-4 rounded-2xl border border-slate-100 dark:border-slate-800">
                <div class="flex flex-col sm:flex-row gap-4 sm:gap-6 w-full md:w-auto">
                    <div class="flex items-center gap-2 overflow-x-auto">
                        <span class="text-xs font-semibold text-slate-400 uppercase tracking-wider whitespace-nowrap">Plattform:</span>
                        <div class="flex gap-1" id="platform-filters"></div>
                    </div>
                    <div class="flex items-center gap-2 overflow-x-auto">
                        <span class="text-xs font-semibold text-slate-400 uppercase tracking-wider whitespace-nowrap">Niv친:</span>
                        <div class="flex gap-1" id="difficulty-filters"></div>
                    </div>
                </div>
                <div class="flex items-center gap-2 ml-auto w-full md:w-auto justify-end">
                    <span class="text-xs font-semibold text-slate-400 uppercase tracking-wider">Sortera:</span>
                    <div class="relative">
                        <select onchange="setSort(this.value)" class="appearance-none bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-300 py-1.5 pl-3 pr-8 rounded-lg text-sm font-medium focus:outline-none focus:ring-2 focus:ring-primary/50 cursor-pointer hover:border-slate-300 dark:hover:border-slate-600 transition-colors">
                            <option value="popular">Mest popul칛ra</option>
                            <option value="recent">Senast tillagda</option>
                            <option value="downloads">Flest nedladdningar</option>
                            <option value="alphabetical">Namn (A-칐)</option>
                        </select>
                        <i data-lucide="chevron-down" class="w-4 h-4 text-slate-400 absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none"></i>
                    </div>
                </div>
            </div>
        </div>

        <div id="workflow-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

        <div id="empty-state" class="hidden text-center py-20">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-slate-100 dark:bg-slate-900 mb-4">
                <i data-lucide="search-x" class="w-8 h-8 text-slate-400"></i>
            </div>
            <h3 class="text-lg font-medium mb-1">Inga tr칛ffar</h3>
            <p class="text-slate-500 dark:text-slate-400 mb-6 max-w-md mx-auto">
                Prova att justera dina filter eller kontakta oss.
            </p>
            <button onclick="resetApp()" class="px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-700 font-medium hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors text-sm">Rensa filter</button>
        </div>

        <div class="mt-16 p-8 rounded-3xl bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900/50 dark:to-slate-900 border border-slate-200 dark:border-slate-800 text-center relative overflow-hidden group">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-primary/50 to-transparent opacity-50"></div>
            <div class="relative z-10">
                <div class="w-14 h-14 bg-white dark:bg-slate-800 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm border border-slate-100 dark:border-slate-700 transform group-hover:scale-110 transition-transform duration-500 rotate-3 group-hover:rotate-6">
                    <i data-lucide="lightbulb" class="w-7 h-7 text-amber-400 fill-amber-400/20"></i>
                </div>
                <h3 class="font-heading text-2xl font-bold mb-3 text-slate-900 dark:text-white">Saknar du ett fl칬de eller en agent?</h3>
                <p class="text-slate-500 dark:text-slate-400 mb-8 max-w-lg mx-auto text-sm leading-relaxed">
                    Vi bygger nya automationer varje vecka baserat p친 communityts behov.
                </p>
                <button onclick="openRequestModal()" class="px-8 py-3.5 bg-slate-900 dark:bg-white text-white dark:text-slate-900 font-bold rounded-xl hover:opacity-90 transition-all shadow-xl shadow-slate-200/50 dark:shadow-none flex items-center gap-2 mx-auto active:scale-95">
                    <i data-lucide="sparkles" class="w-4 h-4"></i>
                    <span>Skicka 칬nskem친l</span>
                </button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="border-t border-slate-200 dark:border-slate-800 py-12 mt-16 bg-slate-50/50 dark:bg-slate-900/50 relative z-10">
        <div class="max-w-7xl mx-auto px-4">
            <div class="mb-16">
                <div class="text-center mb-10">
                    <h3 class="font-heading text-2xl font-bold mb-2">V칛lj din niv친</h3>
                    <p class="text-slate-500">Skala upp din automation n칛r du 칛r redo</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto">
                    <!-- FREE -->
                    <div class="bg-white dark:bg-slate-900 rounded-2xl p-6 border border-slate-200 dark:border-slate-700 flex flex-col">
                        <div class="mb-4"><h4 class="font-bold text-lg">FREE</h4><div class="text-3xl font-bold mt-2">0 kr</div><div class="text-sm text-slate-500">f칬r alltid</div></div>
                        <ul class="space-y-3 mb-8 flex-1">
                            <li class="flex items-center gap-2 text-sm"><i data-lucide="check" class="w-4 h-4 text-emerald-500"></i> 3 nedladdningar / m친nad</li>
                            <li class="flex items-center gap-2 text-sm"><i data-lucide="check" class="w-4 h-4 text-emerald-500"></i> Community flows</li>
                        </ul>
                        <button class="w-full py-3 rounded-xl border border-slate-200 dark:border-slate-700 font-bold hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">Nuvarande plan</button>
                    </div>
                    <!-- PRO -->
                    <div class="bg-white dark:bg-slate-900 rounded-2xl p-6 border-2 border-amber-400 relative flex flex-col shadow-xl shadow-amber-500/10 transform scale-105 z-10">
                        <div class="absolute top-0 right-0 bg-amber-400 text-white text-[10px] font-bold px-2 py-1 rounded-bl-lg rounded-tr-lg">POPUL츿R</div>
                        <div class="mb-4"><h4 class="font-bold text-lg text-amber-500">PRO</h4><div class="text-3xl font-bold mt-2">99 kr<span class="text-sm font-normal text-slate-500">/m친n</span></div></div>
                        <ul class="space-y-3 mb-8 flex-1">
                            <li class="flex items-center gap-2 text-sm"><i data-lucide="check" class="w-4 h-4 text-amber-500"></i> <strong>Obegr칛nsade</strong> nedladdningar</li>
                            <li class="flex items-center gap-2 text-sm"><i data-lucide="check" class="w-4 h-4 text-amber-500"></i> AI-flows</li>
                        </ul>
                        <button onclick="openPaywall('pricing_footer')" class="w-full py-3 rounded-xl bg-amber-500 hover:bg-amber-600 text-white font-bold transition-colors shadow-lg shadow-amber-500/20">Uppgradera nu</button>
                    </div>
                    <!-- ENT -->
                    <div class="bg-white dark:bg-slate-900 rounded-2xl p-6 border border-slate-200 dark:border-slate-700 flex flex-col opacity-75 hover:opacity-100 transition-opacity">
                        <div class="mb-4"><h4 class="font-bold text-lg text-ent">ENTERPRISE</h4><div class="text-3xl font-bold mt-2">499 kr<span class="text-sm font-normal text-slate-500">/m친n</span></div></div>
                        <ul class="space-y-3 mb-8 flex-1">
                            <li class="flex items-center gap-2 text-sm"><i data-lucide="check" class="w-4 h-4 text-ent"></i> Allt i PRO</li>
                            <li class="flex items-center gap-2 text-sm"><i data-lucide="check" class="w-4 h-4 text-ent"></i> Prioriterad support</li>
                        </ul>
                        <button onclick="openEnterpriseModal()" class="block w-full py-3 rounded-xl border border-ent text-ent font-bold text-center hover:bg-ent-light dark:hover:bg-slate-800 transition-colors">G친 med i v칛ntelistan</button>
                    </div>
                </div>
            </div>
            <div class="text-center pt-8 border-t border-slate-200 dark:border-slate-800 mt-8">
                <p class="text-slate-500 text-sm">&copy; 2025 FlowVault by NordSym AB</p>
            </div>
        </div>
    </footer>

    <!-- Modals (Paywall, Auth, Details, Request, Enterprise) -->
    <!-- Paywall -->
    <div id="paywall-modal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-[70] hidden transition-opacity opacity-0 flex items-center justify-center p-4" onclick="closePaywall()">
        <div class="bg-white dark:bg-slate-900 w-full max-w-lg rounded-3xl shadow-2xl overflow-hidden transform scale-95 transition-transform" onclick="event.stopPropagation()">
            <div class="bg-amber-500 p-6 text-white text-center">
                <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-3 backdrop-blur-sm"><i data-lucide="lock" class="w-6 h-6 text-white"></i></div>
                <h3 id="paywall-title" class="text-2xl font-bold font-heading">Uppgradera till PRO</h3>
                <p id="paywall-desc" class="text-amber-100 mt-1 text-sm">L친s upp detta workflow och f친 obegr칛nsad tillg친ng.</p>
                <button onclick="closePaywall()" class="absolute top-4 right-4 text-white/70 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <div class="p-8 flex flex-col gap-3">
                <button onclick="handleProUpgrade(event)" class="w-full py-4 rounded-xl bg-amber-500 hover:bg-amber-600 text-white font-bold text-lg">Skaffa PRO f칬r 99 kr/m친n</button>
                <p class="text-center text-xs text-slate-400">Ingen bindningstid.</p>
            </div>
        </div>
    </div>

    <!-- Auth -->
    <div id="auth-modal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-[70] hidden transition-opacity opacity-0 flex items-center justify-center p-4" onclick="closeAuthModal()">
        <div class="bg-white dark:bg-slate-900 w-full max-w-md rounded-2xl shadow-2xl p-6 relative" onclick="event.stopPropagation()">
            <button onclick="closeAuthModal()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><i data-lucide="x" class="w-5 h-5"></i></button>
            <div id="auth-view-email" class="block">
                <h3 class="font-heading text-xl font-bold mb-2 dark:text-white">Logga in</h3>
                <form onsubmit="handleEmailSubmit(event)" class="space-y-4">
                    <input type="email" id="auth-email" required placeholder="namn@foretag.se" class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border rounded-xl dark:text-white">
                    <button type="submit" class="w-full py-3 bg-slate-900 dark:bg-white text-white dark:text-slate-900 font-bold rounded-xl">Skicka kod</button>
                </form>
            </div>
            <div id="auth-view-code" class="hidden">
                <h3 class="font-heading text-xl font-bold mb-2 dark:text-white">Verifiera</h3>
                <p class="text-sm text-slate-500 mb-4">Kod skickad till <span id="auth-email-display"></span></p>
                <form onsubmit="handleCodeSubmit(event)" class="space-y-4">
                    <input type="text" id="auth-code" required placeholder="123456" class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border rounded-xl text-center text-2xl tracking-widest dark:text-white">
                    <button type="submit" id="auth-code-btn" class="w-full py-3 bg-primary text-white font-bold rounded-xl">Logga in</button>
                </form>
            </div>
            <div id="auth-view-profile" class="hidden text-center">
                <h3 class="font-heading text-xl font-bold mb-1 dark:text-white" id="profile-email"></h3>
                <div class="inline-block px-3 py-1 rounded-full text-xs font-bold bg-slate-100 dark:bg-slate-800 mb-6" id="profile-tier"></div>
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="p-3 bg-slate-50 dark:bg-slate-800 border rounded-xl"><div class="text-2xl font-bold dark:text-white" id="profile-dl-count">0</div><div class="text-[10px] text-slate-500">H칛mtade</div></div>
                    <div class="p-3 bg-slate-50 dark:bg-slate-800 border rounded-xl"><div class="text-2xl font-bold dark:text-white" id="profile-fav-count">0</div><div class="text-[10px] text-slate-500">Favoriter</div></div>
                </div>
                <button onclick="handleLogout()" class="w-full py-3 border rounded-xl font-bold dark:text-white">Logga ut</button>
            </div>
        </div>
    </div>

    <!-- Request Modal -->
    <div id="request-modal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-[70] hidden transition-opacity opacity-0 flex items-center justify-center p-4" onclick="closeRequestModal()">
        <div class="bg-white dark:bg-slate-900 w-full max-w-md rounded-2xl shadow-2xl p-6 relative" onclick="event.stopPropagation()">
            <button onclick="closeRequestModal()" class="absolute top-4 right-4 text-slate-400"><i data-lucide="x" class="w-5 h-5"></i></button>
            <h3 class="font-heading text-xl font-bold mb-2 dark:text-white">칐nska automation</h3>
            <form onsubmit="handleRequestSubmit(event)" class="space-y-4">
                <textarea id="request-desc" required rows="4" placeholder="Beskriv behovet..." class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border rounded-xl dark:text-white"></textarea>
                <input type="email" id="request-email" placeholder="Din email" class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border rounded-xl dark:text-white">
                <button type="submit" id="req-submit-btn" class="w-full py-3 bg-primary text-white font-bold rounded-xl">Skicka</button>
            </form>
        </div>
    </div>

    <!-- Enterprise Modal -->
    <div id="enterprise-modal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-[70] hidden transition-opacity opacity-0 flex items-center justify-center p-4" onclick="closeEnterpriseModal()">
        <div class="bg-white dark:bg-slate-900 w-full max-w-md rounded-2xl shadow-2xl p-6 relative" onclick="event.stopPropagation()">
            <button onclick="closeEnterpriseModal()" class="absolute top-4 right-4 text-slate-400"><i data-lucide="x" class="w-5 h-5"></i></button>
            <h3 class="font-heading text-xl font-bold mb-2 dark:text-white">Enterprise</h3>
            <form onsubmit="handleEnterpriseSubmit(event)" class="space-y-4">
                <input type="email" id="enterprise-email" required placeholder="namn@foretag.se" class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border rounded-xl dark:text-white">
                <button type="submit" id="ent-submit-btn" class="w-full py-3 bg-violet-600 text-white font-bold rounded-xl">G친 med i v칛ntelistan</button>
            </form>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="modal-backdrop" class="fixed inset-0 bg-slate-900/70 backdrop-blur-sm z-50 hidden transition-opacity opacity-0" onclick="closeModal(event)">
        <div class="min-h-screen px-4 text-center overflow-y-auto">
            <span class="inline-block h-screen align-middle">&#8203;</span>
            <div id="modal-content" class="inline-block w-full max-w-2xl p-6 my-8 text-left align-middle bg-white dark:bg-slate-900 shadow-2xl rounded-2xl relative scale-95 opacity-0" onclick="event.stopPropagation()">
                <button onclick="closeModal()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><i data-lucide="x" class="w-6 h-6"></i></button>
                <div class="mb-6">
                    <span id="modal-platform" class="px-2.5 py-0.5 rounded text-xs font-bold uppercase border"></span>
                    <h2 id="modal-title" class="font-heading text-2xl font-bold dark:text-white mt-2"></h2>
                    <p class="text-sm text-slate-500">Av <span id="modal-author"></span></p>
                </div>
                <p id="modal-description" class="text-slate-600 dark:text-slate-300 mb-6"></p>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6 p-4 bg-slate-50 dark:bg-slate-800 rounded-xl">
                    <div><div class="text-[10px] font-bold text-slate-400 uppercase">Sv친righet</div><div class="font-semibold dark:text-white" id="modal-difficulty"></div></div>
                    <div><div class="text-[10px] font-bold text-slate-400 uppercase">Tid</div><div class="font-semibold dark:text-white" id="modal-time"></div></div>
                    <div><div class="text-[10px] font-bold text-slate-400 uppercase">H칛mtad</div><div class="font-semibold dark:text-white" id="modal-downloads"></div></div>
                    <div><div class="text-[10px] font-bold text-slate-400 uppercase">Typ</div><div class="font-semibold dark:text-white" id="modal-platform-text"></div></div>
                </div>
                <div class="flex gap-3 pt-6 border-t dark:border-slate-800">
                    <button id="btn-download" class="flex-1 flex items-center justify-center gap-2 bg-primary text-white font-bold py-3 rounded-xl shadow-md">Ladda ner JSON</button>
                    <button id="btn-copy" class="flex-1 flex items-center justify-center gap-2 bg-slate-100 dark:bg-slate-800 font-bold py-3 rounded-xl dark:text-white">Kopiera</button>
                </div>
                <div class="mt-4 text-center"><a id="modal-help-btn" href="#" class="text-xs text-primary hover:underline">Beh칬ver du hj칛lp med implementation?</a></div>
            </div>
        </div>
    </div>

    <!-- AI Chat -->
    <div id="ai-chat-widget" class="fixed bottom-6 right-6 z-[60]">
        <button id="chat-toggle" class="bg-gradient-to-r from-cyan-400 to-blue-500 text-white p-4 rounded-full shadow-lg" onclick="toggleChat()"><i data-lucide="message-circle" class="w-6 h-6"></i></button>
        <div id="chat-panel" class="hidden absolute bottom-20 right-0 w-[90vw] sm:w-[380px] h-[500px] bg-white dark:bg-slate-900 border rounded-2xl shadow-2xl flex flex-col origin-bottom-right scale-95 opacity-0 transition-all">
            <div class="p-4 border-b dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-800 rounded-t-2xl">
                <h3 class="font-bold text-sm dark:text-white">FlowVault AI</h3>
                <button onclick="toggleChat()"><i data-lucide="x" class="w-5 h-5 text-slate-500"></i></button>
            </div>
            <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4"></div>
            <div id="typing-indicator" class="hidden px-4 py-2"><div class="typing-dot"></div></div>
            <div class="p-3 border-t dark:border-slate-800">
                <form class="flex" onsubmit="handleChatSubmit(event)">
                    <input type="text" id="chat-input" class="w-full pl-4 pr-12 py-3 bg-slate-100 dark:bg-slate-800 border-0 rounded-xl dark:text-white" placeholder="Fr친ga...">
                    <button type="submit" class="absolute right-5 bottom-5 text-primary"><i data-lucide="send" class="w-4 h-4"></i></button>
                </form>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-6 left-6 z-50 transform translate-y-20 opacity-0 transition-all duration-300 pointer-events-none">
        <div class="bg-slate-900 dark:bg-white text-white dark:text-slate-900 px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 font-medium">
            <i data-lucide="check" class="w-5 h-5 text-emerald-400 dark:text-emerald-600"></i>
            <span id="toast-message">Kopierat!</span>
        </div>
    </div>

    <script>
        // --- LIVE CONFIG ---
        const GITHUB_CONFIG = {
            user: 'nordsym',
            repo: 'flowvault-json',
            branch: 'main'
        };

        const API_BASE = 'https://nordsym.app.n8n.cloud/webhook';
        const API_ENDPOINTS = {
            workflows: `${API_BASE}/flowvault-workflows`,
            download: (id) => `${API_BASE}/flowvault-download/${id}`,
            authInit: `${API_BASE}/flowvault-auth-init`,
            authVerify: `${API_BASE}/auth/verify`,
            request: `${API_BASE}/flowvault-request`,
            createCheckout: `${API_BASE}/flowvault-create-checkout`,
            chat: 'https://nordsym.app.n8n.cloud/webhook/5d2f97e8-0938-4fae-a660-5121f4b4fab7/chat'
        };
        
        // --- PARSED DATA FROM USER DUMP ---
        // This replaces the static mock data with the real workflows found in the user's text dump.
        // IDs like 'kNsX2qu8jHY' map to filenames 'kNsX2qu8jHY.json' on GitHub.
        const STATIC_WORKFLOWS = [
            { id: "kNsX2qu8jHY", title: "AI Agent with Zep Memory", description: "Unlock the Next Evolution of Agents with Human-like Memory (n8n + zep).", category: "ai-automation", platform: "n8n", difficulty: "advanced", downloads: 1540, verified: true, proBadge: true, estimatedTime: "60 min", author: "Nate Herk", tags: ["ai", "memory", "zep"], useCases: ["Advanced AI"] },
            { id: "qNW9KaLe1nY", title: "Parallel Workflow Accelerator", description: "Only 1% of n8n Builders Use This Trick (7x faster).", category: "productivity", platform: "n8n", difficulty: "advanced", downloads: 900, verified: true, proBadge: true, estimatedTime: "30 min", author: "Nate Herk", tags: ["speed", "parallel", "n8n"], useCases: ["DevOps"] },
            { id: "yueOIxkDig0", title: "Podcast Clip Automation", description: "Generate 100s of Viral Podcast TikTok Clips & Reels with This AI System.", category: "social", platform: "n8n", difficulty: "advanced", downloads: 2100, verified: true, proBadge: true, estimatedTime: "50 min", author: "Nick Saraev", tags: ["podcast", "clips", "audio"], useCases: ["Podcasters"] },
            { id: "M0s6O8xtVUE", title: "AI Resume Screening System", description: "Watch Me Build an AI Resume Analysis System in 28 minutes.", category: "productivity", platform: "n8n", difficulty: "intermediate", downloads: 1200, verified: true, proBadge: true, estimatedTime: "30 min", author: "Nate Herk", tags: ["hr", "resume", "ai"], useCases: ["HR"] },
            { id: "xWhX61651H8", title: "RAG Agents Workflow", description: "n8n Just Leveled Up RAG Agents (Reranking & Metadata).", category: "ai-automation", platform: "n8n", difficulty: "advanced", downloads: 1560, verified: true, proBadge: true, estimatedTime: "55 min", author: "Nate Herk", tags: ["ai", "rag", "metadata"], useCases: ["Knowledge"] },
            { id: "GNmlnt52aSM", title: "PPC Thievery", description: "Scrape high-performing ads from Facebook Ad Library and process with AI.", category: "sales", platform: "n8n", difficulty: "advanced", downloads: 900, verified: true, proBadge: true, estimatedTime: "45 min", author: "Nick Saraev", tags: ["ads", "ppc", "competitor"], useCases: ["Marketing"] },
            { id: "9HBa364RZBk", title: "Meeting Prep Automation", description: "This n8n Automation Does ALL My Meeting Prep While I Sleep.", category: "sales", platform: "n8n", difficulty: "intermediate", downloads: 720, verified: true, proBadge: false, estimatedTime: "35 min", author: "Mark Kashef", tags: ["ai", "meetings", "research"], useCases: ["Sales"] },
            { id: "Ch-AWxvX2Jc", title: "YT Strategist Agent", description: "I Built a YT Strategist AI Agent That Makes Me $6k/mo.", category: "social", platform: "n8n", difficulty: "advanced", downloads: 1340, verified: true, proBadge: false, estimatedTime: "35 min", author: "Nate Herk", tags: ["youtube", "strategy", "ai"], useCases: ["Creators"] },
            { id: "RvuPRX-b7Lc", title: "Viral ASMR Shorts", description: "This AI System Posts Viral ASMR Shorts Hourly.", category: "social", platform: "n8n", difficulty: "intermediate", downloads: 850, verified: true, proBadge: false, estimatedTime: "40 min", author: "Nate Herk", tags: ["video", "asmr", "shorts"], useCases: ["Content"] },
            { id: "gXKzEt1ZG38", title: "Client Onboarding System", description: "I Built an AI System that Onboards Clients in 30 Seconds.", category: "specialized", platform: "n8n", difficulty: "intermediate", downloads: 1800, verified: true, proBadge: false, estimatedTime: "40 min", author: "Nolan Harper", tags: ["onboarding", "client", "sales"], useCases: ["Sales"] },
            { id: "Ik8OHT3w4pE", title: "AI Agent Team Builder", description: "I Built an AI Agent that Builds Entire Teams of AI Agents in n8n.", category: "ai-automation", platform: "n8n", difficulty: "advanced", downloads: 1600, verified: true, proBadge: true, estimatedTime: "50 min", author: "Nate Herk", tags: ["ai", "agents", "builder"], useCases: ["Dev"] },
            { id: "0PJNiDuihBg", title: "FB Ad Spy Tool", description: "Build A Facebook Ad Spy Tool With N8N.", category: "sales", platform: "n8n", difficulty: "intermediate", downloads: 1000, verified: true, proBadge: false, estimatedTime: "35 min", author: "Nick Saraev", tags: ["facebook", "ads", "spy"], useCases: ["Marketing"] },
            { id: "acB2o6nwAn8", title: "AI Video Analysis", description: "The Simplest Setup for FREE AI Video Analysis (n8n + Google Gemini).", category: "ai-automation", platform: "n8n", difficulty: "intermediate", downloads: 840, verified: true, proBadge: false, estimatedTime: "30 min", author: "Nate Herk", tags: ["ai", "video", "analysis"], useCases: ["Content"] },
            { id: "axBR8S7AepQ", title: "Viral AI Videos", description: "Generate VIRAL AI Videos Using Veo 3 in N8N!", category: "social", platform: "n8n", difficulty: "advanced", downloads: 2500, verified: true, proBadge: true, estimatedTime: "55 min", author: "Mahmut Kasimoglu", tags: ["video", "ai", "viral"], useCases: ["Content"] },
            { id: "DrqR7a7lmBE", title: "Graphic Design AI Agent", description: "Watch Me Build a Graphic Design AI Agent Team That Works 24/7.", category: "content", platform: "n8n", difficulty: "advanced", downloads: 1890, verified: true, proBadge: true, estimatedTime: "45 min", author: "Nick Saraev", tags: ["design", "ai", "graphics"], useCases: ["Design"] },
            { id: "mNcXue7X8H0", title: "Local AI Agent Workflow", description: "The Ultimate Guide to Local AI and AI Agents.", category: "ai-automation", platform: "n8n", difficulty: "advanced", downloads: 1200, verified: true, proBadge: false, estimatedTime: "60 min", author: "Cole Medin", tags: ["local", "ai", "agent"], useCases: ["Dev"] },
            { id: "0iUNOmeU7O4", title: "Multi-Agent Orchestrator", description: "Multi-Agent Systems Have NEVER Been EASIER to Build.", category: "ai-automation", platform: "n8n", difficulty: "advanced", downloads: 1500, verified: true, proBadge: true, estimatedTime: "60 min", author: "Nate Herk", tags: ["ai", "multi-agent", "orchestrator"], useCases: ["Advanced AI"] },
            { id: "ar37oypyATQ", title: "Browser Agent", description: "I Built the Ultimate Browser Agent with No Code.", category: "ai-automation", platform: "n8n", difficulty: "advanced", downloads: 950, verified: true, proBadge: true, estimatedTime: "45 min", author: "Nate Herk", tags: ["browser", "agent", "scraping"], useCases: ["Data"] },
            { id: "nGNm4IBZpGg", title: "ChatGPT Image Workflow", description: "Connect ChatGPTs New Image Model to n8n.", category: "content", platform: "n8n", difficulty: "intermediate", downloads: 1400, verified: true, proBadge: true, estimatedTime: "25 min", author: "Jono Catliff", tags: ["image", "chatgpt", "ai"], useCases: ["Design"] },
            { id: "7NIN0KNcVdM", title: "Real-Time Insights System", description: "This AI Agent INSTANTLY Pulls Real-Time Insights from X.", category: "social", platform: "n8n", difficulty: "advanced", downloads: 1100, verified: true, proBadge: true, estimatedTime: "40 min", author: "Mark Kashef", tags: ["twitter", "insights", "real-time"], useCases: ["Marketing"] },
            { id: "1uDXVb7zp0Q", title: "Prompt Accuracy Flow", description: "Stop Hallucinations: Perfect Your n8n Prompts.", category: "ai-automation", platform: "n8n", difficulty: "intermediate", downloads: 600, verified: true, proBadge: false, estimatedTime: "40 min", author: "MagicOps AI", tags: ["prompt", "accuracy", "ai"], useCases: ["Dev"] },
            { id: "3Pim6uCASSE", title: "Web Scraper Agent", description: "This AI Agent Can Scrape and Screenshot the Web with No Code.", category: "sales", platform: "n8n", difficulty: "intermediate", downloads: 1300, verified: true, proBadge: false, estimatedTime: "40 min", author: "Nate Herk", tags: ["scraper", "web", "screenshot"], useCases: ["Data"] },
            { id: "lEo7IAgj0UY", title: "Twitter Data Scraper", description: "How to Actually Scrape Twitter/X Data with n8n.", category: "social", platform: "n8n", difficulty: "intermediate", downloads: 1100, verified: true, proBadge: false, estimatedTime: "30 min", author: "Nate Herk", tags: ["twitter", "data", "scraper"], useCases: ["Research"] },
            { id: "oAWe5wFwHlo", title: "Deep Cold Email Outreach", description: "I Deep-Personalized 1000+ Cold Emails Using THIS AI System.", category: "sales", platform: "n8n", difficulty: "advanced", downloads: 2100, verified: true, proBadge: true, estimatedTime: "50 min", author: "Nick Saraev", tags: ["email", "sales", "outreach"], useCases: ["Sales"] }
        ];

        let WORKFLOWS = [...STATIC_WORKFLOWS]; 
        let userState = JSON.parse(localStorage.getItem('flowvault_user_state')) || {
            tier: 'free', downloads: [], favorites: [], email: null, isAuthenticated: false, token: null
        };
        const FREE_LIMIT = 3;
        const UI_TEXT = { difficulties: { beginner: "Nyb칬rjare", intermediate: "Medel", advanced: "Avancerad" } };
        
        let state = { search: '', categoryFilter: 'all', platformFilter: 'all', difficultyFilter: 'all', sort: 'popular' };
        let chatState = { isOpen: false, history: [] };
        
        // --- DATA CONSTANTS (Missing in prev version) ---
        const CATEGORIES = [
            { id: 'all', label: 'Alla', icon: 'layout-grid' },
            { id: 'favorites', label: 'Favoriter', icon: 'star' },
            { id: 'swedish', label: 'Svenska Integrationer', icon: '游젏릖' },
            { id: 'ai-automation', label: 'AI Automation', icon: 'bot' },
            { id: 'social', label: 'Social Media', icon: 'share-2' },
            { id: 'sales', label: 'Sales & CRM', icon: 'briefcase' },
            { id: 'content', label: 'Content Creation', icon: 'palette' },
            { id: 'productivity', label: 'Produktivitet', icon: 'zap' },
            { id: 'specialized', label: 'Specialized', icon: 'wrench' }
        ];
        const PLATFORMS = [ { id: 'all', label: 'Alla' }, { id: 'n8n', label: 'n8n' }, { id: 'make', label: 'Make' }, { id: 'zapier', label: 'Zapier' } ];
        const DIFFICULTIES = [ { id: 'all', label: 'Alla' }, { id: 'beginner', label: 'Nyb칬rjare' }, { id: 'intermediate', label: 'Medel' }, { id: 'advanced', label: 'Avancerad' } ];

        // --- DOM ---
        const gridEl = document.getElementById('workflow-grid');
        const filtersEl = document.getElementById('category-filters');
        const platformFiltersEl = document.getElementById('platform-filters');
        const difficultyFiltersEl = document.getElementById('difficulty-filters');
        const emptyStateEl = document.getElementById('empty-state');
        const searchInputEl = document.getElementById('search-input');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modalContent = document.getElementById('modal-content');
        const modalHelpBtn = document.getElementById('modal-help-btn');
        const chatPanel = document.getElementById('chat-panel');
        const chatToggle = document.getElementById('chat-toggle');
        const chatInput = document.getElementById('chat-input');
        const chatMessages = document.getElementById('chat-messages');
        const typingIndicator = document.getElementById('typing-indicator');
        const paywallModal = document.getElementById('paywall-modal');
        const dlCountEl = document.getElementById('dl-count');
        const authModal = document.getElementById('auth-modal');
        const authBtnDot = document.getElementById('auth-status-dot');
        const requestModal = document.getElementById('request-modal'); 
        const enterpriseModal = document.getElementById('enterprise-modal');

        function init() {
            renderControls();
            renderHeader(); 
            renderWorkflows();
            initTheme();
            initStarfall(); 
            updateAuthUI(); 
            lucide.createIcons();
        }

        // --- CORE FUNCTIONS (Restored) ---
        
        function renderControls() {
            filtersEl.innerHTML = CATEGORIES.map(cat => {
                const iconHtml = cat.id === 'swedish' 
                    ? `<span class="text-lg leading-none">${cat.icon}</span>` 
                    : `<i data-lucide="${cat.icon}" class="w-4 h-4"></i>`;
                return `<button onclick="setCategory('${cat.id}')" class="px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 border flex items-center gap-2 ${state.categoryFilter === cat.id ? 'bg-slate-900 text-white dark:bg-white dark:text-slate-900 border-transparent shadow-lg scale-105' : 'bg-white dark:bg-slate-900 text-slate-600 dark:text-slate-400 border-slate-200 dark:border-slate-800 hover:border-primary/50 hover:text-primary'}">${iconHtml} ${cat.label}</button>`;
            }).join('');
            
            platformFiltersEl.innerHTML = PLATFORMS.map(p => `<button onclick="setPlatform('${p.id}')" class="px-2.5 py-1 rounded-md text-xs font-medium transition-colors border ${state.platformFilter === p.id ? 'bg-slate-200 dark:bg-slate-700 text-slate-900 dark:text-white border-slate-300 dark:border-slate-600' : 'bg-transparent text-slate-500 dark:text-slate-400 border-transparent hover:bg-slate-100 dark:hover:bg-slate-800'}">${p.label}</button>`).join('');
            difficultyFiltersEl.innerHTML = DIFFICULTIES.map(d => `<button onclick="setDifficulty('${d.id}')" class="px-2.5 py-1 rounded-md text-xs font-medium transition-colors border ${state.difficultyFilter === d.id ? 'bg-slate-200 dark:bg-slate-700 text-slate-900 dark:text-white border-slate-300 dark:border-slate-600' : 'bg-transparent text-slate-500 dark:text-slate-400 border-transparent hover:bg-slate-100 dark:hover:bg-slate-800'}">${d.label}</button>`).join('');
            lucide.createIcons();
        }

        function renderHeader() {
            if (userState.tier === 'free') {
                dlCountEl.textContent = userState.downloads.length;
                if (userState.downloads.length >= FREE_LIMIT) {
                    dlCountEl.classList.remove('text-primary');
                    dlCountEl.classList.add('text-red-500');
                }
            } else {
                document.getElementById('download-counter').innerHTML = '<span class="text-xs font-bold text-amber-500 bg-amber-100 dark:bg-amber-900/30 px-2 py-1 rounded border border-amber-200 dark:border-amber-700">PRO PLAN</span>';
            }
            updateAuthUI();
        }

        function renderWorkflows() {
             let filtered = WORKFLOWS.filter(wf => {
                const matchesSearch = wf.title.toLowerCase().includes(state.search.toLowerCase()) || wf.description.toLowerCase().includes(state.search.toLowerCase());
                let matchesCategory = true;
                if (state.categoryFilter === 'favorites') matchesCategory = userState.favorites.includes(wf.id);
                else if (state.categoryFilter !== 'all') matchesCategory = wf.category === state.categoryFilter;
                const matchesPlatform = state.platformFilter === 'all' || wf.platform === state.platformFilter;
                const matchesDifficulty = state.difficultyFilter === 'all' || wf.difficulty === state.difficultyFilter;
                return matchesSearch && matchesCategory && matchesPlatform && matchesDifficulty;
            });

            if (state.sort === 'popular') filtered.sort((a, b) => b.downloads - a.downloads);
            else if (state.sort === 'recent') filtered.reverse();
            else if (state.sort === 'downloads') filtered.sort((a, b) => b.downloads - a.downloads);
            else if (state.sort === 'alphabetical') filtered.sort((a, b) => a.title.localeCompare(b.title));
            
            if (filtered.length === 0) { gridEl.classList.add('hidden'); emptyStateEl.classList.remove('hidden'); return; }
            gridEl.classList.remove('hidden'); emptyStateEl.classList.add('hidden');

            gridEl.innerHTML = filtered.map(wf => {
                let badge = '';
                if (wf.category === 'swedish') badge = `<span class="bg-sky-50 dark:bg-sky-900/30 text-sky-700 dark:text-sky-300 border border-sky-100 dark:border-sky-800 px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider flex items-center gap-1.5 shadow-sm">游젏릖 Svensk</span>`;
                else if (wf.proBadge) badge = `<span class="badge-pro px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider flex items-center gap-1"><i data-lucide="crown" class="w-3 h-3"></i> PRO</span>`;

                const isLocked = wf.proBadge && userState.tier === 'free';
                const actionIcon = isLocked ? 'lock' : 'arrow-right';
                const actionText = isLocked ? 'L친s upp' : 'Visa';
                const isFav = userState.favorites.includes(wf.id);

                return `
                <div class="group relative bg-white dark:bg-slate-900 rounded-2xl border ${wf.proBadge ? 'border-amber-200 dark:border-amber-900/50' : 'border-slate-200 dark:border-slate-800'} p-6 hover:border-primary/50 transition-all duration-300 hover:shadow-xl hover:-translate-y-1 flex flex-col h-full cursor-pointer" onclick="handleWorkflowClick('${wf.id}')">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex flex-wrap gap-2">
                            <span class="px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider platform-${wf.platform}">${wf.platform}</span>
                            ${badge}
                        </div>
                        <div class="flex items-center gap-2">
                            ${wf.verified ? `<span class="text-emerald-500 dark:text-emerald-400" title="Verifierad"><i data-lucide="check-circle-2" class="w-5 h-5"></i></span>` : ''}
                            <button onclick="toggleFavorite(event, '${wf.id}')" class="text-slate-400 hover:text-amber-400 hover:scale-110 transition-all focus:outline-none z-20" title="${isFav ? 'Ta bort favorit' : 'L칛gg till favorit'}">
                                <i data-lucide="star" class="w-5 h-5 ${isFav ? 'fill-amber-400 text-amber-400' : ''}"></i>
                            </button>
                        </div>
                    </div>
                    <h3 class="font-heading text-lg font-bold mb-2 text-slate-900 dark:text-slate-100 group-hover:text-primary transition-colors leading-tight">${wf.title}</h3>
                    <p class="text-slate-500 dark:text-slate-400 text-sm line-clamp-3 mb-6 flex-grow">${wf.description}</p>
                    <div class="flex items-center justify-between text-xs font-medium text-slate-400 mb-4 pb-4 border-b border-slate-50 dark:border-slate-800/50">
                        <div class="flex items-center gap-1.5"><i data-lucide="download" class="w-3.5 h-3.5"></i> ${wf.downloads.toLocaleString('sv-SE')}</div>
                        <div class="capitalize flex items-center gap-1.5"><i data-lucide="bar-chart-2" class="w-3.5 h-3.5"></i> ${UI_TEXT.difficulties[wf.difficulty] || wf.difficulty}</div>
                    </div>
                    <div class="flex items-center justify-between mt-auto">
                        <div class="flex -space-x-2">
                             ${wf.tags.slice(0, 2).map(tag => `<span class="bg-slate-100 dark:bg-slate-800 text-slate-500 text-[10px] px-2 py-0.5 rounded-full border border-white dark:border-slate-900">#${tag}</span>`).join('')}
                        </div>
                        <span class="text-primary text-sm font-semibold flex items-center gap-1 group-hover:translate-x-1 transition-transform">${actionText} <i data-lucide="${actionIcon}" class="w-4 h-4"></i></span>
                    </div>
                </div>
            `}).join('');
            lucide.createIcons();
        }

        function updateAuthUI() {
            if (userState.isAuthenticated) {
                authBtnDot.className = "absolute top-1.5 right-1.5 w-2 h-2 rounded-full bg-emerald-500 border-2 border-white dark:border-slate-950";
            } else {
                authBtnDot.className = "absolute top-1.5 right-1.5 w-2 h-2 rounded-full bg-slate-300 border-2 border-white dark:border-slate-950";
            }
        }

        function initStarfall() {
            const canvas = document.getElementById('starfall');
            if(!canvas) return;
            const ctx = canvas.getContext('2d');
            let width = window.innerWidth;
            let height = window.innerHeight;
            let stars = [];
            let meteors = [];
            const STAR_COUNT = 400; 
            const METEOR_COUNT = 4;
            
            canvas.width = width;
            canvas.height = height;
            
            window.addEventListener('resize', () => { width = window.innerWidth; height = window.innerHeight; canvas.width = width; canvas.height = height; if (stars.length > 0) stars.forEach(star => star.reset(true)); });

            class Star {
                constructor() { this.reset(true); }
                reset(initial = false) { this.x = Math.random() * width; this.y = initial ? Math.random() * height : -10; this.size = Math.random() * 1.5 + 0.5; this.speed = Math.random() * 0.2 + 0.05; this.opacity = Math.random() * 0.5 + 0.1; this.twinkleDir = Math.random() > 0.5 ? 0.005 : -0.005; }
                update() { this.y += this.speed; this.opacity += this.twinkleDir; if (this.opacity > 0.7 || this.opacity < 0.1) this.twinkleDir = -this.twinkleDir; if (this.y > height) this.reset(); }
                draw() { ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill(); }
            }
            class Meteor {
                constructor() { this.reset(); }
                reset() { this.x = Math.random() * width; this.y = -100; this.length = Math.random() * 80 + 20; this.speed = Math.random() * 10 + 5; this.size = Math.random() * 1 + 0.5; this.angle = Math.PI / 4 + (Math.random() * 0.2 - 0.1); this.active = false; setTimeout(() => { this.active = true; }, Math.random() * 5000); }
                update() { if (!this.active) return; this.x -= this.speed * Math.cos(this.angle); this.y += this.speed * Math.sin(this.angle); if (this.y > height + 100 || this.x < -100) this.reset(); }
                draw() { if (!this.active) return; const endX = this.x + this.length * Math.cos(this.angle); const endY = this.y - this.length * Math.sin(this.angle); const gradient = ctx.createLinearGradient(this.x, this.y, endX, endY); gradient.addColorStop(0, 'rgba(0, 191, 255, 1)'); gradient.addColorStop(1, 'rgba(0, 191, 255, 0)'); ctx.strokeStyle = gradient; ctx.lineWidth = this.size; ctx.lineCap = 'round'; ctx.beginPath(); ctx.moveTo(this.x, this.y); ctx.lineTo(endX, endY); ctx.stroke(); }
            }
            for (let i = 0; i < STAR_COUNT; i++) stars.push(new Star());
            for (let i = 0; i < METEOR_COUNT; i++) meteors.push(new Meteor());
            function animate() { ctx.clearRect(0, 0, width, height); if (document.documentElement.classList.contains('dark')) { stars.forEach(star => { star.update(); star.draw(); }); meteors.forEach(meteor => { meteor.update(); meteor.draw(); }); } requestAnimationFrame(animate); }
            animate();
        }

        // --- GITHUB DOWNLOAD LOGIC ---
        async function downloadJSON(workflow) {
            const btn = document.getElementById('btn-download');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<div class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> Letar...';
            
            try {
                // Remove invalid chars from ID to match filename safety
                const safeId = workflow.id.replace(/[^a-zA-Z0-9-_]/g, '');
                const attempts = [
                    `${safeId}.json`,
                    `${safeId.toLowerCase()}.json`
                ];

                let response = null;
                let foundUrl = '';

                for (const filename of attempts) {
                    const url = `https://raw.githubusercontent.com/${GITHUB_CONFIG.user}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/${filename}`;
                    try {
                        const checkRes = await fetch(url, { method: 'HEAD' });
                        if (checkRes.ok) {
                            response = await fetch(url);
                            foundUrl = url;
                            break; 
                        }
                    } catch (e) {}
                }
                
                if (!response || !response.ok) throw new Error('Filen saknas');

                const blob = await response.blob();
                const downloadUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = downloadUrl;
                a.download = `${workflow.title.replace(/[^a-zA-Z0-9-_ ]/g, '')}.json`; 
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(downloadUrl);

                showToast("Nedladdning startad! 游");

                // Track download
                if (USE_BACKEND) {
                    fetch(API_ENDPOINTS.download(workflow.id), {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ userId: userState.email || 'anonymous', tier: userState.tier, timestamp: new Date().toISOString() })
                    }).catch(err => console.warn('Tracking failed', err));
                }

                userState.downloads.push({ id: workflow.id, timestamp: new Date().toISOString() });
                localStorage.setItem('flowvault_user_state', JSON.stringify(userState));
                renderHeader();

            } catch (error) {
                console.error('Download error:', error);
                showToast(`Filen kunde inte hittas (ID: ${workflow.id}).`, true);
            } finally {
                btn.innerHTML = originalText;
            }
        }

        // Rest of standard functions
        function handleWorkflowClick(id) {
            const wf = WORKFLOWS.find(w => w.id === id);
            if (wf.proBadge && userState.tier === 'free') openPaywall('pro_content');
            else openModal(id);
        }
        function tryDownload(workflow) {
            if (userState.tier === 'free') {
                if (userState.downloads.length >= FREE_LIMIT) {
                    closeModal(); setTimeout(() => openPaywall('limit_reached'), 300); return;
                }
            }
            downloadJSON(workflow);
        }
        function copyJSON(workflow) {
            const dataStr = JSON.stringify(workflow.json || {name: workflow.title}, null, 2);
            navigator.clipboard.writeText(dataStr).then(() => showToast("JSON kopierat!")).catch(err => showToast("Kunde inte kopiera", true));
        }
        function toggleFavorite(e, id) { e.stopPropagation(); const index = userState.favorites.indexOf(id); if (index === -1) { userState.favorites.push(id); showToast("Tillagd i favoriter"); } else { userState.favorites.splice(index, 1); } localStorage.setItem('flowvault_user_state', JSON.stringify(userState)); renderWorkflows(); }
        function handleSearch(query) { state.search = query; renderWorkflows(); }
        function setCategory(id) { state.categoryFilter = id; renderControls(); renderWorkflows(); }
        function setPlatform(id) { state.platformFilter = id; renderControls(); renderWorkflows(); }
        function setDifficulty(id) { state.difficultyFilter = id; renderControls(); renderWorkflows(); }
        function setSort(val) { state.sort = val; renderWorkflows(); }
        function resetApp() { state.search = ''; state.categoryFilter = 'all'; searchInputEl.value = ''; renderControls(); renderWorkflows(); }
        function getEmailLink(workflow = null) { return `mailto:support@nordsym.com?subject=${encodeURIComponent(workflow ? `Hj칛lp med: ${workflow.title}` : 'Fr친ga om automation')}`; }
        function renderStats() { animateValue("stat-workflows", 0, WORKFLOWS.length, 1000); animateValue("stat-downloads", 0, WORKFLOWS.reduce((acc, curr) => acc + (curr.downloads || 0), 0), 1500); }
        function animateValue(id, start, end, duration) { const obj = document.getElementById(id); if(!obj) return; let startTimestamp = null; const step = (timestamp) => { if (!startTimestamp) startTimestamp = timestamp; const progress = Math.min((timestamp - startTimestamp) / duration, 1); obj.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString('sv-SE'); if (progress < 1) window.requestAnimationFrame(step); }; window.requestAnimationFrame(step); }
        function initTheme() { if (localStorage.theme === 'dark') document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark'); document.getElementById('theme-toggle').addEventListener('click', () => { document.documentElement.classList.toggle('dark'); localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light'; }); }
        
        // Ensure init runs
        if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init); else init();
    </script>
</body>
</html>
